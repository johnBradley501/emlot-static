# Information about xxx2json.py

The first thing to note is that there is no file actually called "xxx2json.py": instead there is one Python script for each kind of EMLoT data that needs to be created to support keyword searching and facetted browsing.

* **events2json.py** creates JSON data about EMLoT events,
* **persons2json.py** creates JSON data about EMLoT persons,
* **prisources2json.py** creates JSON data about EMLoT primary sources,
* **records2json.py** creates JSON data about EMLoT records,
* **secsources2json.py** creates JSON data about EMLoT secondary sources,
* **troupes2json.py** creates JSON data about EMLoT Troupes, and
* **venues2json.py** creates JSON data about EMLoT Venues.

The code is quite similar in all of these, but was just different enough that it didn't seem to be worth the effort to put it all together in a single script.  So, if new JSON data needs to be generated, each of these scripts has to be run.

## Python-MySQL connection module.
This script uses `mysqlclient` as its module (which supports "`import MySQLdb`") to enable MySQL querying.  Like most things Python, it can be installed using pip.  The version I have when this page was created was 2.2.0, but probably almost any version will work.

## What is produced
Each file runs one or more MYSQL queries against the EMLoT database and creates JSON material which it stores in a file called "ks-\<datatype\>.js" (e.g., "ks-events.js" from events2json.py for EMLoT event data).

The generated file created by events2json.py looks like this (and the ones created by other xxx2json.py scripts are similar):
```
function getEventData(){
    return
[[3771, "undated", "undated", "'Jane Shore' is rewritten for the Worcester's Men at the Rose", "'Jane Shore' is rewritten for the Worcester's Men at the Rose Henslowe pays \u00a340 to have 'The Tragedy of Jane Shore' rewritten for Worcester's Men at the Rose. undated undated  Rose   ", [323], [3], [1]],
 [676, "From: circa 1623", "undated", "A balladeer is robbed at the Red Bull", "A balladeer is robbed at the Red Bull A balladeer writes of having his purse, hat and cloak stolen while at the Red Bull. From: circa 1623\t undated playhouse context public disturbance Red Bull   ", [], [], [19]],

... etc, down to ...


 [209, "From: 12 November 1589", "From: 12 November 1989", "Plays are to be censored by a committee", "Plays are to be censored by a committee Plays in London are to be censored by a committee of three persons, including the appointees of, respectively, the Archbishop of Canterbury and Lord Mayor of London, and the Master of the Revels. The Privy Council orders three letters to this effect drafted and sent to the concerned parties. From: 12 November 1589 From: 12 November 1989 play censorship Rose  William, 10th Baron Cobham Brooke Lord William, Baron Burghley Cecil Sir Christopher Hatton  Lord Charles, Earl of Nottingham Howard Richard Martin Sir John Perrott Lord Thomas, Baron Buckhurst Sackville Esquire Edmund Tilney Sir Francis Walsingham John Whitgift", [1074, 1084, 1087, 813, 2815, 122, 720, 1266, 1267, 503], [], [1]]]
; }
```

A few things to note about this:
* The generated JSON is wrapped in a bit of Javascript (the first two lines, and the last line) so that it can be incorporated into EMLoT's web pages where it is needed with an HTML "<script..." tag. Within the Javascript code, one gets to this files data by invoking its JavaScript function: for events it is  `getEventData()`.
* The JSON itself is a JSON array: one entry for each item that EMLoT has in its database.
* The data for each item, which is again an array, starts with the item's key.
* Following the key is mostly data that is used to generate the tabular display that Browse and KeyWord search pages.  Since the tabular display for different data types varies, the entries here vary too.
* One of the items generated by all scripts (except `records2json.py` because it isn't needed for records) is the text to be given to fuse.py to provide the basis for textual searching provided in keyword searching. For events, it is the 5th item. The script pulls it from the column suggestively called `helper_keywordsearch` in the relevent table: for events, the table `ltbapp_event`.
* The last three items in each entry are, again, lists. For events they are the IDs for persons, troupes and venues associated with the event. They are transformed into displayable names and links by the JavaScript code that processes them.
* In all xxx2json scripts that display dates, date information in the MySQL database is turned into display dates. Indeed, almost all the more complex code in the xxx2json scripts are the Python functions to do this.

## Before running an xxx2json.py script
Before you can run this script you will probably need to make two changes to it:
* First,  you need to give information that will allow it to connect to the EMLoT database.  As described on [the front page of this repo](./README.md), you need to create a file containing MySQL credentials that will provide database access and store it somewhere.  Then, set the path and file name to it in variable "`db_credentials`" which can be found near the top of this script.
* Then, you need to specify where the script is to store the JS/JSON file that it will create.  Edit variable "`workdir`" which can be found near the top of this script. Strictly speaking, the variable is misnamed: note the first part of the filename the script is to use ("`ks-`") is coded here too.

Finally, to make the file as small as possible the script generates the JSON contents in the condensed form which is almost unreadable by humans.  To make the script generate a bigger, but more readable file, you can change the outfile.write line near the end of the script to ask the JSON processor to create the output in the more reader-friendly indented form:

```
outfile.write(json.dumps(events, indent=4))
```
